{
  "id": "8d585760-e195-428a-814d-446f9bbd0f87",
  "name": "ReadExtendedEventsDeadlock",
  "prefix": "ReadExtendedEventsDeadlock",
  "description": "",
  "body": ";WITH xmlData AS (\n                     -- Read in the xe_deadlock file, returning the raw deadlock info as XML\n                     SELECT CAST(event_data AS XML) AS data\n                     FROM   sys.fn_xe_file_target_read_file ('G:\\EE\\dead*.xel', NULL, NULL, NULL)\n                 )\n    , xmlReport AS (\n                       -- extract informaton about the deadlock VICTIM using XQuery\n                       SELECT\n                            xmlData.data.value ('(/event/data/value/deadlock/process-list/process/@lasttranstarted)[1]', 'datetime')  AS [Event Time]\n                          , xmlData.data.value ('(/event/data/value/deadlock/resource-list/keylock/@objectname)[1]', 'nvarchar(max)') AS object\n                          , xmlData.data.value ('(/event/data/value/deadlock/process-list/process/@clientapp)[1]', 'nvarchar(256)')   AS Application\n                          , xmlData.data.value ('(/event/data/value/deadlock/process-list/process/@hostname)[1]', 'nvarchar(256)')    AS Hostname\n                          , xmlData.data.value ('(/event/data/value/deadlock/process-list/process/@loginname)[1]', 'nvarchar(256)')   AS Login\n                          , xmlData.data.value ('(/event/data/value/deadlock/resource-list/keylock/@indexname)[1]', 'nvarchar(256)')  AS [Index]\n                          , xmlData.data.value ('(/event/data/value/deadlock/process-list/process/@waittime)[1]', 'int')              AS [Wait Time (ms)]\n                          , xmlData.data.value ('(/event/data/value/deadlock/resource-list/keylock/@mode)[1]', 'char(1)')             AS [Lock Mode]\n                          , xmlData.data.query ('(event/data/value/deadlock)[1]')                                                     AS [Deadlock Graph]\n                       FROM xmlData\n                   )\nSELECT\n         xmlReport.[Event Time]\n       , PARSENAME (xmlReport.object, 3) AS [Database]\n       , PARSENAME (xmlReport.object, 2) AS [Schema]\n       , PARSENAME (xmlReport.object, 1) AS [Table]\n       , xmlReport.Application\n       , xmlReport.Hostname\n       , xmlReport.Login\n       , xmlReport.[Index]\n       , xmlReport.[Wait Time (ms)]\n       , xmlReport.[Lock Mode]\n       , xmlReport.[Deadlock Graph]\nFROM     xmlReport\nORDER BY xmlReport.[Event Time] DESC;",
  "placeholders": []
}